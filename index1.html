<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Segunda M√£o Mangop</title>
  <link rel="icon" type="image/jpeg" href="imagens/logo-mangop.jpg">
  <style>
    :root { --primary:#0077b6; --accent:#90e0ef; --bg:#f7fbff; --text:#023e8a; --card:#fff; }
    body { font-family:'Segoe UI',system-ui,sans-serif; margin:0; background:var(--bg); color:var(--text); }
    header { position:sticky; top:0; z-index:1000; background:var(--primary); color:#fff; padding:1rem;
      display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    header h1 { margin:0; font-size:1.2rem; }
    header p { margin:0; font-size:0.9rem; font-style:italic; }
    .search-bar { display:flex; gap:0.5rem; max-width:420px; flex:1; }
    .search-bar input, .search-bar button { padding:0.6rem; border-radius:6px; border:1px solid #d8dce2; }
    .search-bar button { background:#fff; color:#0077b6; font-weight:600; cursor:pointer; }

    .content { display:grid; grid-template-columns:250px 1fr 320px; gap:1rem; padding:1rem; }
    .sidebar { background:var(--card); border:1px solid #eef0f4; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.06); padding:1rem; height:fit-content; position:sticky; top:5rem; }
    .sidebar h2 { margin:0 0 .5rem; font-size:1.05rem; border-bottom:2px solid #eef0f4; padding-bottom:.5rem; }
    .filtros label { display:block; font-weight:600; margin:0.6rem 0 0.2rem; }
    .filtros select, .filtros input { width:100%; padding:0.5rem; border-radius:6px; border:1px solid #ccc; }

    .container { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1rem; }
    .product { background:var(--card); border:1px solid #eef0f4; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.06); padding:0.9rem; }
    .product img { width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:8px; background:#e9edf3; }
    .price { font-weight:600; color:var(--primary); }
    .product small { color:#6c7a92; }

    .cart-item { display:grid; grid-template-columns:1fr auto auto; gap:.5rem; align-items:center; margin-bottom:.5rem; }
    .cart-total { display:flex; justify-content:space-between; padding-top:.6rem; border-top:2px solid #eef0f4; font-weight:600; margin-top:.5rem; }

    button { background:var(--primary); color:#fff; border:none; padding:.55rem .7rem; border-radius:6px; cursor:pointer; font-size:.9rem; }
    button.outline { background:transparent; color:var(--primary); border:1px solid var(--primary); }

    .btn-acao {
      display:inline-block;
      margin:.5rem .3rem 0 0;
      padding:.6rem 1rem;
      border-radius:6px;
      font-weight:600;
      text-decoration:none;
      color:#fff;
    }
    .btn-whatsapp { background:#25D366; }
    .btn-publicar { background:#0077b6; }
    .btn-carrinho { background:#0096c7; }

    .btn-flutuante {
      position:fixed;
      bottom:20px;
      left:20px;
      background:#fff;
      color:#0077b6;
      border:2px solid #0077b6;
      padding:.6rem 1rem;
      border-radius:8px;
      font-weight:600;
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
      z-index:999;
    }

    footer { background:var(--accent); color:var(--text); text-align:center; padding:1rem; margin-top:2rem; }
    .banner { background:#e0f7fa; border-radius:12px; padding:1.2rem; margin-top:2rem; box-shadow:0 2px 6px rgba(0,0,0,0.08); line-height:1.6; }
    .banner h3 { margin-top:0; color:#0077b6; font-size:1.2rem; }
    .banner p { margin:0.8rem 0; font-size:1rem; }
    .banner a { display:inline-block; margin-top:1rem; background:#0077b6; color:#fff; padding:0.6rem 1.2rem; border-radius:6px; text-decoration:none; font-weight:600; }
    @media (max-width:900px){ .content{ grid-template-columns:1fr; } .sidebar{ position:static; } }
  </style>
</head>
<body>
  <header>
    <a href="index.html" style="text-decoration:none; display:flex; align-items:center; gap:1rem;">
      <img src="imagens/logo-mangop.jpg" alt="Logomarca Segunda M√£o Mangop" style="height:60px;" />
      <div>
        <h1 style="margin:0; font-size:1.2rem;">Segunda M√£o Mangop</h1>
        <p style="margin:0; font-size:0.9rem; font-style:italic;">N√£o √© lixo, √© oportunidade</p>
      </div>
    </a>
    <div class="search-bar">
      <input id="search" type="text" placeholder="Pesquisar produto..." />
      <button class="outline" id="clearSearch">Limpar</button>
    </div>
  </header>

  <main class="content">
    <aside class="sidebar filtros">
      <h2>üîé Filtros</h2>
      <label for="filtroCategoria">Categoria</label>
      <select id="filtroCategoria">
        <option value="">Todas</option>
        <option>M√≥veis</option><option>Eletr√≥nica</option><option>Moda</option>
        <option>Casa e Jardim</option><option>Ferramentas</option><option>Outros</option>
      </select>
      <label for="filtroEstado">Estado</label>
      <select id="filtroEstado">
        <option value="">Todos</option>
        <option>Usado</option><option>Como novo</option><option>Selado</option>
      </select>
      <label for="filtroMarca">Marca</label>
      <input id="filtroMarca" type="text" placeholder="Ex: Samsung, Bosch..." />
      <label for="filtroPreco">Ordenar por pre√ßo</label>
      <select id="filtroPreco">
        <option value="">Sem ordena√ß√£o</option>
        <option value="asc">Menor pre√ßo</option>
        <option value="desc">Maior pre√ßo</option>
      </select>
    </aside>

    <section>
      <div class="container" id="product-list"></div>
      <h2>Itens similares</h2>
      <div class="container" id="suggestions"></div>
      <div class="banner">
        <h3>üì¢ Publicar an√∫ncio gr√°tis</h3>
        <p><strong>üí° Vende o que j√° n√£o usas:</strong><br>D√° uma nova vida ao que est√° parado em tua casa e ganha um dinheiro extra.</p>
        <p><strong>üì∑ Imagens do produto:</strong><br>Devem ser anexadas diretamente na conversa do WhatsApp ap√≥s enviar o an√∫ncio.</p>
        <p><strong>‚è≥ Validade do an√∫ncio:</strong><br>Os an√∫ncios expiram automaticamente ap√≥s 7 dias e s√£o removidos do cat√°logo.</p>
        <a href="publicar.html" class="btn-acao btn-publicar">üì¢ Publicar an√∫ncio</a>
        <a href="carrinho.html" class="btn-acao btn-carrinho">üõí Ir para Carrinho</a>
      </div>
    </section>

       <aside class="sidebar">
      <h2>Carrinho</h2>
      <div id="cart-items"></div>
      <div class="cart-total">
        <span>Total</span>
        <span id="cart-total">0 Kz</span>
      </div>
      <button id="checkoutBtn">Finalizar Compra</button>
      <a href="https://wa.me/244976194731" target="_blank" class="btn-acao btn-whatsapp">Conversar no WhatsApp</a>
      <a href="publicar.html" class="btn-acao btn-publicar">üì¢ Publicar an√∫ncio</a>
      <a href="carrinho.html" class="btn-acao btn-carrinho">üõí Ir para Carrinho</a>
    </aside>
  </main>

  <footer>
    Segunda M√£o Mangop ‚Äì N√£o √© lixo, √© oportunidade<br>
    üìç Kilamba, Luanda ‚Äì Angola | üì≤ WhatsApp: +244976194731
  </footer>

  <!-- Bot√£o flutuante para resetar filtros -->
  <button id="resetFilters" class="btn-flutuante">üîÑ Ver todos os produtos</button>

  <script>
    const IMG_PH = 'data:image/svg+xml;utf8,' +
      encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300">
        <rect width="100%" height="100%" fill="#e9edf3"/>
        <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
              font-family="Segoe UI" font-size="16" fill="#6c7a92">Segunda M√£o Mangop</text>
      </svg>`);

    const seteDias = 7 * 24 * 60 * 60 * 1000;
    const fmtKZ = (v) => `${v.toLocaleString('pt-PT')} Kz`;
    const byId = (id) => document.getElementById(id);

    let produtos = JSON.parse(localStorage.getItem("produtosSegundaMaoMangop")) || [];

    if (produtos.length === 0) {
      produtos = [
        {id:1, name:"Smartphone Samsung A12", price:85000, category:"Eletr√≥nica", estado:"Como novo", marca:"Samsung", image:"imagens/samsungA12.jpg", criadoEm:Date.now()},
        {id:2, name:"Smartphone Samsung A13", price:95000, category:"Eletr√≥nica", estado:"Usado", marca:"Samsung", image:"imagens/samsungA13.jpg", criadoEm:Date.now()},
        {id:3, name:"iPhone 11", price:250000, category:"Eletr√≥nica", estado:"Usado", marca:"Apple", image:"imagens/iphone11.jpg", criadoEm:Date.now()},
        {id:4, name:"Huawei P30", price:120000, category:"Eletr√≥nica", estado:"Como novo", marca:"Huawei", image:"imagens/huaweiP30.jpg", criadoEm:Date.now()},
        {id:5, name:"Smart TV LG 42\"", price:180000, category:"Eletr√≥nica", estado:"Selado", marca:"LG", image:"imagens/tvLG42.jpg", criadoEm:Date.now()},
        {id:6, name:"Mesa de jantar 6 lugares", price:45000, category:"M√≥veis", estado:"Usado", marca:"Madeira Angola", image:"imagens/mesa.jpg", criadoEm:Date.now()},
        {id:7, name:"Conjunto de sof√°s 3+2", price:95000, category:"M√≥veis", estado:"Como novo", marca:"DecoLux", image:"imagens/sofa.jpg", criadoEm:Date.now()},
        {id:8, name:"Cadeira de escrit√≥rio", price:30000, category:"M√≥veis", estado:"Usado", marca:"OfficePro", image:"imagens/cadeira.jpg", criadoEm:Date.now()},
        {id:9, name:"Estante de madeira", price:60000, category:"M√≥veis", estado:"Como novo", marca:"Madeira Angola", image:"imagens/estante.jpg", criadoEm:Date.now()},
        {id:10, name:"T√©nis Nike Air", price:25000, category:"Moda", estado:"Usado", marca:"Nike", image:"imagens/nikeAir.jpg", criadoEm:Date.now()},
        {id:11, name:"Casaco Adidas", price:40000, category:"Moda", estado:"Como novo", marca:"Adidas", image:"imagens/casacoAdidas.jpg", criadoEm:Date.now()},
        {id:12, name:"Mala Louis Vuitton", price:150000, category:"Moda", estado:"Selado", marca:"Louis Vuitton", image:"imagens/malaLV.jpg", criadoEm:Date.now()},
        {id:13, name:"Liquidificador Philips", price:20000, category:"Casa e Jardim", estado:"Usado", marca:"Philips", image:"imagens/liquidificador.jpg", criadoEm:Date.now()},
        {id:14, name:"Microondas Samsung", price:35000, category:"Casa e Jardim", estado:"Como novo", marca:"Samsung", image:"imagens/microondas.jpg", criadoEm:Date.now()},
        {id:15, name:"Ventoinha Midea", price:15000, category:"Casa e Jardim", estado:"Usado", marca:"Midea", image:"imagens/ventoinha.jpg", criadoEm:Date.now()},
        {id:16, name:"Furadeira Bosch", price:50000, category:"Ferramentas", estado:"Como novo", marca:"Bosch", image:"imagens/furadeira.jpg", criadoEm:Date.now()},
        {id:17, name:"Serra el√©trica Makita", price:75000, category:"Ferramentas", estado:"Usado", marca:"Makita", image:"imagens/serra.jpg", criadoEm:Date.now()},
        {id:18, name:"Kit de chaves Stanley", price:25000, category:"Ferramentas", estado:"Selado", marca:"Stanley", image:"imagens/chaves.jpg", criadoEm:Date.now()},
        {id:19, name:"Bicicleta Caloi", price:80000, category:"Outros", estado:"Usado", marca:"Caloi", image:"imagens/bicicleta.jpg", criadoEm:Date.now()},
        {id:20, name:"Cole√ß√£o de livros", price:20000, category:"Outros", estado:"Como novo", marca:"Diversos", image:"imagens/livros.jpg", criadoEm:Date.now()}
      ];
    }

    const agora = Date.now();
    produtos = produtos.filter(p => (agora - p.criadoEm) < seteDias);
    localStorage.setItem("produtosSegundaMaoMangop", JSON.stringify(produtos));

    let cart = JSON.parse(localStorage.getItem("carrinhoSegundaMaoMangop")) || [];

    function renderProducts(list) {
      const el = byId("product-list");
      el.innerHTML = "";
      list.forEach(p => {
        const imgSrc = (p.image && p.image.trim()) ? p.image : IMG_PH;
        const card = document.createElement("div");
        card.className = "product";
        card.innerHTML = `
          <img src="${imgSrc}" alt="${p.name}">
          <h3>${p.name}</h3>
          <div class="price">${fmtKZ(p.price)}</div>
          <p><small>${p.estado || "Estado n√£o definido"} | ${p.marca || "Marca n√£o definida"}</small></p>
          <button onclick="addToCart(${p.id})">Adicionar ao carrinho</button>
          <button class="outline" onclick="moreLikeThis('${p.category}','${p.marca}')">Ver similares</button>
        `;
        el.appendChild(card);
      });
    }

    function moreLikeThis(category, marca) {
      const subset = produtos.filter(p =>
        (p.category || "").toLowerCase() === category.toLowerCase() ||
        (p.marca || "").toLowerCase() === marca.toLowerCase()
      );
      renderProducts(subset);
    }

    function recommend(baseProduct) {
      const similares = produtos.filter(p =>
        p.id !== baseProduct.id &&
        (
          (p.category && baseProduct.category &&
           p.category.trim().toLowerCase() === baseProduct.category.trim().toLowerCase()) ||
          (p.marca && baseProduct.marca &&
           p.marca.trim().toLowerCase() === baseProduct.marca.trim().toLowerCase())
        )
      ).slice(0, 3);

      const el = byId("suggestions");
      el.innerHTML = "";
      if (similares.length === 0) {
        el.innerHTML = "<p>Sem itens similares no momento.</p>";
        return;
      }
      similares.forEach(p => {
        const card = document.createElement("div");
        card.className = "product";
        card.innerHTML = `
          <img src="${p.image || IMG_PH}" alt="${p.name}">
          <h3>${p.name}</h3>
                    <div class="price">${fmtKZ(p.price)}</div>
          <button onclick="addToCart(${p.id})">Adicionar</button>
        `;
        el.appendChild(card);
      });
    }

    function renderCart() {
      const itemsEl = byId("cart-items");
      itemsEl.innerHTML = "";
      cart.forEach((item, index) => {
        const subtotal = item.price * (item.quantidade || 1);
        const row = document.createElement("div");
        row.className = "cart-item";
        row.innerHTML = `
          <span>${item.name}</span>
          <span>${fmtKZ(item.price)} (cada)</span>
          <div>
            <button onclick="alterarQuantidade(${index}, -1)">-</button>
            <span>${item.quantidade || 1}</span>
            <button onclick="alterarQuantidade(${index}, 1)">+</button>
            <span>Subtotal: ${fmtKZ(subtotal)}</span>
            <button class="outline" onclick="removeFromCart(${index})">Remover</button>
          </div>
        `;
        itemsEl.appendChild(row);
      });
      const total = cart.reduce((sum, i) => sum + i.price * (i.quantidade || 1), 0);
      byId("cart-total").textContent = fmtKZ(total);
    }

    function alterarQuantidade(index, delta) {
      cart[index].quantidade = (cart[index].quantidade || 1) + delta;
      if (cart[index].quantidade <= 0) {
        removeFromCart(index);
      } else {
        localStorage.setItem("carrinhoSegundaMaoMangop", JSON.stringify(cart));
        renderCart();
      }
    }

    function addToCart(id) {
      const produto = produtos.find(p => p.id === id);
      if (!produto) return;
      const existente = cart.find(p => p.id === id);
      if (existente) {
        existente.quantidade = (existente.quantidade || 1) + 1;
      } else {
        cart.push({ ...produto, quantidade: 1 });
      }
      localStorage.setItem("carrinhoSegundaMaoMangop", JSON.stringify(cart));
      renderCart();
      recommend(produto);
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem("carrinhoSegundaMaoMangop", JSON.stringify(cart));
      renderCart();
    }

    function finalizePurchase() {
      if (cart.length === 0) { alert("Carrinho vazio!"); return; }
      localStorage.setItem("carrinhoSegundaMaoMangop", JSON.stringify(cart));
      localStorage.setItem("lastPage", window.location.href);
      window.location.href = "carrinho.html";
    }

    function aplicarFiltros() {
      const categoria = byId("filtroCategoria").value;
      const preco = byId("filtroPreco").value;
      const estado = byId("filtroEstado").value;
      const marca = byId("filtroMarca").value.trim().toLowerCase();

      let filtrados = [...produtos];
      if (categoria) filtrados = filtrados.filter(p => (p.category || "").toLowerCase() === categoria.toLowerCase());
      if (estado) filtrados = filtrados.filter(p => (p.estado || "").toLowerCase() === estado.toLowerCase());
      if (marca) filtrados = filtrados.filter(p => p.marca && p.marca.toLowerCase().includes(marca));
      if (preco === "asc") filtrados.sort((a,b) => a.price - b.price);
      if (preco === "desc") filtrados.sort((a,b) => b.price - a.price);

      renderProducts(filtrados);
    }

    function searchProducts(query) {
      const q = query.trim().toLowerCase();
      if (!q) { renderProducts(produtos); return; }
      const ranked = produtos
        .map(p => {
          let score = 0;
          const fields = [p.name.toLowerCase(), (p.marca||"").toLowerCase(), (p.category||"").toLowerCase()];
          fields.forEach(f => { if (f.includes(q)) score += 2; });
          if (p.name.toLowerCase().startsWith(q)) score += 1.5;
          return { p, score };
        })
        .filter(x => x.score > 0)
        .sort((a, b) => b.score - a.score)
        .map(x => x.p);
      renderProducts(ranked);
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderProducts(produtos);
      renderCart();
      byId("checkoutBtn").addEventListener("click", finalizePurchase);
      byId("search").addEventListener("input", (e) => searchProducts(e.target.value));
      byId("clearSearch").addEventListener("click", () => {
        byId("search").value = "";
        renderProducts(produtos);
      });
      ["filtroCategoria","filtroPreco","filtroEstado","filtroMarca"].forEach(id => {
        byId(id).addEventListener("input", aplicarFiltros);
      });
      byId("resetFilters").addEventListener("click", () => {
        byId("search").value = "";
        byId("filtroCategoria").value = "";
        byId("filtroEstado").value = "";
        byId("filtroMarca").value = "";
        byId("filtroPreco").value = "";
        renderProducts(produtos);
      });
    });
  </script>
</body>
</html>